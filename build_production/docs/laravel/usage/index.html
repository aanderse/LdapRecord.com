<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="description" content="LdapRecord-Laravel Usage Guide">

        <meta property="og:site_name" content="LdapRecord"/>
        <meta property="og:title" content="Usage | LdapRecord"/>
        <meta property="og:description" content="LdapRecord-Laravel Usage Guide"/>
        <meta property="og:url" content="https://ldaprecord.com/docs/laravel/usage"/>
        <meta property="og:image" content="/assets/img/logo.png"/>
        <meta property="og:type" content="website"/>

        <meta name="twitter:image:alt" content="LdapRecord">
        <meta name="twitter:card" content="summary_large_image">

                    <meta name="generator" content="tighten_jigsaw_doc">
        
        <title>LdapRecord | Usage</title>

        <link rel="home" href="https://ldaprecord.com">
        <link rel="icon" href="/favicon.ico">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <link rel="manifest" href="/site.webmanifest">
        <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
        <meta name="msapplication-TileColor" content="#da532c">
        <meta name="theme-color" content="#ffffff">

        
        <link rel="stylesheet" href="/assets/build/css/main.css?id=d5769ff5b0719b74766f">

                    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
            </head>
    <body class="antialiased font-sans">
        <nav class="flex items-center h-24 py-12 z-20 border-gradient-l-purple-light border-b-8 mb-2" role="banner">
            <div class="container flex items-center max-w-8xl mx-auto px-4 lg:px-8">
                <div class="flex items-center">
                    <a href="/" title="LdapRecord home" class="inline-flex items-center">
                        <img class="h-20 md:h-24 mr-3" src="/assets/img/logo.svg" alt="LdapRecord logo" />
                    </a>
                </div>

                <div class="flex flex-1 justify-end items-center text-right md:pl-10 text-gray-800">
                                            <button
    title="Start searching"
    type="button"
    class="flex md:hidden bg-gray-100 hover:bg-blue-100 justify-center items-center shadow rounded focus:outline-none h-10 px-3"
    onclick="searchInput.toggle()"
>
    <img src="/assets/img/magnifying-glass.svg" alt="search icon" class="h-4 w-4 max-w-none">
</button>

<div id="js-search-input" class="docsearch-input__wrapper hidden md:block">
    <label for="search" class="hidden">Search</label>

    <input
        id="docsearch-input"
        class="docsearch-input block h-10 transition-fast w-full lg:w-1/2 xl:w-1/3 outline-none rounded text-gray-700 focus:border-blue-400 ml-auto px-4 pb-0 shadow"
        name="docsearch"
        type="text"
        placeholder="Search"
    >

    <button
        class="md:hidden absolute right-0 mr-8 h-full font-light text-3xl text-blue-500 hover:text-blue-600 focus:outline-none -mt-px"
        onclick="searchInput.toggle()"
    >&times;</button>
</div>

                    
                                            <a href="/docs/" class="ml-6 hidden md:inline whitespace-no-wrap text-gray-800 hover:text-purple-700" title="LdapRecord Documentation Link">
                            Core Docs
                        </a>

                        <a href="https://github.com/DirectoryTree/LdapRecord-Laravel" class="hidden text-gray-800 hover:text-purple-700 sm:inline">
                            <svg class="fill-current w-8 ml-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><title>GitHub</title><path d="M10 0a10 10 0 0 0-3.16 19.49c.5.1.68-.22.68-.48l-.01-1.7c-2.78.6-3.37-1.34-3.37-1.34-.46-1.16-1.11-1.47-1.11-1.47-.9-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.9 1.52 2.34 1.08 2.91.83.1-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.94 0-1.1.39-1.99 1.03-2.69a3.6 3.6 0 0 1 .1-2.64s.84-.27 2.75 1.02a9.58 9.58 0 0 1 5 0c1.91-1.3 2.75-1.02 2.75-1.02.55 1.37.2 2.4.1 2.64.64.7 1.03 1.6 1.03 2.69 0 3.84-2.34 4.68-4.57 4.93.36.31.68.92.68 1.85l-.01 2.75c0 .26.18.58.69.48A10 10 0 0 0 10 0"></path></svg>
                        </a>
                                    </div>
            </div>

                <button class="flex justify-center items-center bg-purple-500 shadow h-10 mr-4 px-5 rounded lg:hidden focus:outline-none"
    onclick="navMenu.toggle()"
>
    <svg id="js-nav-menu-show" xmlns="http://www.w3.org/2000/svg"
        class="fill-current text-white h-9 w-4" viewBox="0 0 32 32"
    >
        <path d="M4,10h24c1.104,0,2-0.896,2-2s-0.896-2-2-2H4C2.896,6,2,6.896,2,8S2.896,10,4,10z M28,14H4c-1.104,0-2,0.896-2,2  s0.896,2,2,2h24c1.104,0,2-0.896,2-2S29.104,14,28,14z M28,22H4c-1.104,0-2,0.896-2,2s0.896,2,2,2h24c1.104,0,2-0.896,2-2  S29.104,22,28,22z"/>
    </svg>

    <svg id="js-nav-menu-hide" xmlns="http://www.w3.org/2000/svg"
        class="hidden fill-current text-white h-9 w-4" viewBox="0 0 36 30"
    >
        <polygon points="32.8,4.4 28.6,0.2 18,10.8 7.4,0.2 3.2,4.4 13.8,15 3.2,25.6 7.4,29.8 18,19.2 28.6,29.8 32.8,25.6 22.2,15 "/>
    </svg>
</button>

        </nav>

        <main role="main" class="w-full">
            <div class="relative h-full max-w-screen-xl mx-auto">
                                    <svg style="left:100%;" width="404" height="784" fill="none" viewBox="0 0 404 784" class="absolute hidden sm:block transform translate-y-64 -translate-x-64">
                        <defs>
                            <pattern id="f210dbf6-a58d-4871-961e-36d5016a0f49" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse">
                                <rect x="0" y="0" width="4" height="4" fill="currentColor" class="text-gray-200"></rect>
                            </pattern>
                        </defs>
                        <rect width="404" height="784" fill="url(#f210dbf6-a58d-4871-961e-36d5016a0f49)"></rect>
                    </svg>
                            </div>

                <section class="container relative max-w-8xl mx-auto px-6 md:px-8 py-4">
        <div class="flex flex-col lg:flex-row">
            <nav id="js-nav-menu" class="nav-menu hidden lg:block">
                    <ul class="list-none my-0 ">
            <li class="pl-4">
            
        <p class="nav-menu__item text-gray-500 font-extrabold text-xs tracking-widest uppercase italic pt-2">Introduction</p>
    
            
        <ul class="list-none my-0 border-l-4 border-purple-200">
            <li class="pl-4">
            
        <a href="/docs/laravel/quickstart"
            class="lvl1  text-gray-700 nav-menu__item hover:text-purple-500"
        >
            Quickstart
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel"
            class="lvl1  text-gray-700 nav-menu__item hover:text-purple-500"
        >
            Overview
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel/installation"
            class="lvl1  text-gray-700 nav-menu__item hover:text-purple-500"
        >
            Installation
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel/usage"
            class="lvl1  active font-semibold text-purple-600 nav-menu__item hover:text-purple-500"
        >
            Usage
        </a>
    
    </li>
    </ul>
    </li>
            <li class="pl-4">
            
        <p class="nav-menu__item text-gray-500 font-extrabold text-xs tracking-widest uppercase italic pt-2">Authentication</p>
    
            
        <ul class="list-none my-0 border-l-4 border-purple-200">
            <li class="pl-4">
            
        <a href="/docs/laravel/auth/quickstart"
            class="lvl1  text-gray-700 nav-menu__item hover:text-purple-500"
        >
            Quickstart
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel/auth"
            class="lvl1  text-gray-700 nav-menu__item hover:text-purple-500"
        >
            Overview
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel/auth/installation"
            class="lvl1  text-gray-700 nav-menu__item hover:text-purple-500"
        >
            Installation
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel/auth/configuration"
            class="lvl1  text-gray-700 nav-menu__item hover:text-purple-500"
        >
            Configuration
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel/auth/setup"
            class="lvl1  text-gray-700 nav-menu__item hover:text-purple-500"
        >
            Setup &amp; Features
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel/auth/multi-domain"
            class="lvl1  text-gray-700 nav-menu__item hover:text-purple-500"
        >
            Multi-Domain
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel/auth/importing"
            class="lvl1  text-gray-700 nav-menu__item hover:text-purple-500"
        >
            Importing Users
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel/auth/testing"
            class="lvl1  text-gray-700 nav-menu__item hover:text-purple-500"
        >
            Testing
        </a>
    
    </li>
    </ul>
    </li>
            <li class="pl-4">
            
        <p class="nav-menu__item text-gray-500 font-extrabold text-xs tracking-widest uppercase italic pt-2">Other Features</p>
    
            
        <ul class="list-none my-0 border-l-4 border-purple-200">
            <li class="pl-4">
            
        <a href="/docs/laravel/lumen"
            class="lvl1  text-gray-700 nav-menu__item hover:text-purple-500"
        >
            Lumen
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel/events"
            class="lvl1  text-gray-700 nav-menu__item hover:text-purple-500"
        >
            Events
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel/testing"
            class="lvl1  text-gray-700 nav-menu__item hover:text-purple-500"
        >
            Testing
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel/debugging"
            class="lvl1  text-gray-700 nav-menu__item hover:text-purple-500"
        >
            Debugging
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel/importing"
            class="lvl1  text-gray-700 nav-menu__item hover:text-purple-500"
        >
            Importing Objects
        </a>
    
    </li>
    </ul>
    </li>
            <li class="pl-4">
            
        <p class="nav-menu__item text-gray-500 font-extrabold text-xs tracking-widest uppercase italic pt-2">Extra</p>
    
            
        <ul class="list-none my-0 border-l-4 border-purple-200">
            <li class="pl-4">
            
        <a href="/docs/laravel/versioning"
            class="lvl1  text-gray-700 nav-menu__item hover:text-purple-500"
        >
            Versioning
        </a>
    
    </li>
            <li class="pl-4">
            
        <a href="/docs/laravel/license"
            class="lvl1  text-gray-700 nav-menu__item hover:text-purple-500"
        >
            License
        </a>
    
    </li>
    </ul>
    </li>
    </ul>

    <div class="block sm:hidden">
        <hr class="my-4"/>

        <ul class="list-none my-0">
            <li class="pl-4">
                <a href="/docs/"
                   class="nav-menu__item hover:text-blue-500"
                >
                    Core Documentation
                </a>
            </li>

            <li class="pl-4">
                <a href="https://github.com/DirectoryTree/LdapRecord-Laravel"
                   class="nav-menu__item hover:text-blue-500"
                >
                    Source Code
                </a>
            </li>
        </ul>
    </div>
            </nav>

            <div class="DocSearch-content content w-full lg:w-3/5 break-words pb-16 lg:pl-4" v-pre>
                <h1>Usage</h1>

<ul>
<li><a href="#models">Models</a>

<ul>
<li><a href="#searching">Searching</a></li>
<li><a href="#crud">Creating &amp; Updating</a></li>
<li><a href="#scopes">Scopes</a></li>
</ul></li>
<li><a href="#plain-auth">Plain Authentication</a></li>
</ul>

<h2 id="models">Models</h2>

<blockquote>
  <p>This usage documentation is intentionally kept short and sweet to prevent duplication.
  Be sure to review the core <a href="/docs">LdapRecord documentation</a> as it explains
  all of LdapRecord's features in-depth.</p>
</blockquote>

<p>Once you've configured your connections in your <code>config/ldap.php</code> file,
you're ready to start running queries and operations on your LDAP server.</p>

<p>If you're connecting to an Active Directory or OpenLDAP server, you may utilize the
<a href="/docs/models#predefined-models">built-in models</a> to get up and running right away.</p>

<p>If you would like to create your own models, you can generate one via the <code>make:ldap-model</code> command:</p>

<pre><code class="language-bash">php artisan make:ldap-model User
</code></pre>

<p>This will create a new LdapRecord model inside of your application in the <code>app/Ldap</code> folder.</p>

<blockquote>
  <p>If the <code>Ldap</code> folder does not exist, it will be created automatically.</p>
</blockquote>

<p>By default, the generated model will not have any <code>$objectClasses</code> set. LdapRecord requires
this attribute to be set for objects to be created properly in your directory.</p>

<p>If no <code>$objectClasses</code> are set, queries will not be scoped to the object you are querying
and you will have to set the models <code>$objectClasses</code> manually before creating new objects.</p>

<pre><code class="language-php">namespace App\Ldap;

use LdapRecord\Models\Model;

class User extends Model
{
    public static $objectClasses = [
        'top',
        'person',
        'organizationalperson',
        'user',
    ];
}
</code></pre>

<blockquote>
  <p>You may want to extend from the <code>LdapRecord\Models\ActiveDirectory\Entry</code> class to
  utilize some helper methods that are limited to the use of Active Directory.
  </br></br>
  This can save you time from having to implement functionality manually.</p>
</blockquote>

<h3 id="searching">Searching</h3>

<p>To begin querying your model, you can statically call <a href="/docs/searching">query methods</a> off of the model:</p>

<pre><code class="language-php">$users = User::where('company', '=', 'Acme')-&gt;get();
</code></pre>

<p>When using the above example model for searching your LDAP directory, the following filter will be used:</p>

<pre><code class="language-text">(&amp;(objectclass=top)(objectclass=person)(objectclass=organizationalperson)(objectclass=user)(company=Acme))
</code></pre>

<h3 id="creating-and-updating">Creating / Updating</h3>

<p>To create a new object in your directory, call the <code>create</code> method:</p>

<pre><code class="language-php">$user = User::create([
    'company'   =&gt; 'Acme',
    'givenname' =&gt; 'Steve',
    'sn'        =&gt; 'Bauman',
    'cn'        =&gt; 'Steve Bauman',
]);
</code></pre>

<p>When creating the above example model, the <code>objectclass</code> attribute will automatically be
sent with all other attributes you have set for the user creation. This effectively
creates the proper object in your directory.</p>

<p>You may also create a new model instance, set its attributes, and call the <code>save</code> method:</p>

<pre><code class="language-php">$user = new User;

$user-&gt;cn = 'Steve Bauman';
$user-&gt;givenname = 'Steve';
$user-&gt;sn = 'Bauman';
$user-&gt;company = 'Acme';

$user-&gt;save();
</code></pre>

<p>Similarly, to update an object, modify a model that was returned from a query and call the <code>save</code> method:</p>

<pre><code class="language-php">$user = User::find('cn=Steve Bauman,dc=local,dc=com');

$user-&gt;company = 'Acme';

$user-&gt;save();
</code></pre>

<blockquote>
  <p>If you need help understanding user creation and management, take a look at the Active Directory 
  <a href="/docs/active-directory/users/">user management tutorial</a>.</p>
</blockquote>

<h3 id="scopes">Scopes</h3>

<p>Sometimes you may need to utilize several of the same query filters around your application.
Model scopes are a perfect for this, as you can extract these filters into its own class
and apply it to a model query.</p>

<blockquote>
  <p>Be sure to take a peek at the <a href="/docs/models#query-scopes">query scopes</a>
  documentation for a more in-depth look.</p>
</blockquote>

<p>To create a new model scope, call the command:</p>

<pre><code class="language-bash">php artisan make:ldap-scope OnlyAccountants
</code></pre>

<p>This will create a new model scope in your applications <code>app\Ldap\Scopes</code> directory.</p>

<pre><code class="language-php">namespace App\Ldap\Scopes;

use LdapRecord\Models\Model;
use LdapRecord\Models\Scope;
use LdapRecord\Query\Model\Builder;

class OnlyAccountants implements Scope
{
    public function apply(Builder $query, Model $model)
    {
        $query-&gt;where('title', '=', 'Accountant');
    }
}
</code></pre>

<p>Now, you can either apply this scope globally so the query filter is applied on every
query of your model, or apply it when you need it. Let's walk through both.</p>

<p>To apply your scope globally, override your models protected static <code>boot</code>
method, and then call the <code>addGlobalScope</code> method:</p>

<pre><code class="language-php">namespace App\Ldap;

use LdapRecord\Models\Model;
use App\Ldap\Scopes\OnlyAccountants;

class User extends Model
{
    // ...

    protected static function boot()
    {
        parent::boot();

        static::addGlobalScope(new OnlyAccountants);
    }
}
</code></pre>

<blockquote>
  <p>You must pass a <strong>new</strong> instance of your scope into the <code>addGlobalScope</code> method, <strong>not</strong> the class name.</p>
</blockquote>

<p>Any search queries that are performed on your <code>User</code> model will now be properly scoped.</p>

<p>If you wish to apply a scope in certain situations, you may use the <code>withGlobalScope</code> method:</p>

<pre><code class="language-php">$accountants = User::withGlobalScope('accountants', new OnlyAccountants)-&gt;get();
</code></pre>

<p>As you may have noticed above, you must provide a named string for the scope you are passing in.</p>

<h2 id="plain-auth">Plain Authentication</h2>

<p>Sometimes you simply want to know if a users LDAP credentials are valid.
To do this, you must retrieve your LDAP connection from the LdapRecord
<a href="/docs/connections/#container">connection container</a>.</p>

<p>To do so, you must call the <code>getConnection</code> method on the <code>Container</code> and pass in the name of
your connection that appears in your <code>config/ldap.php</code> file:</p>

<pre><code class="language-php">use LdapRecord\Container;

$connection = Container::getConnection('default');
</code></pre>

<p>To retrieve your <code>default</code> connection that you have set in your <code>ldap.php</code> configuration
file, call the <code>getDefaultConnection</code> method:</p>

<pre><code class="language-php">use LdapRecord\Container;

$connection = Container::getDefaultConnection();
</code></pre>

<p>Once you have your connection, call the <code>auth()-&gt;attempt</code> method with your users
Distinguished Name and their password:</p>

<pre><code class="language-php">use LdapRecord\Container;

$connection = Container::getConnection('default');

if ($connection-&gt;auth()-&gt;attempt('cn=user,dc=local,dc=com', 'SuperSecret')) {
    // Credentials are valid!
}
</code></pre>

<p>If you don't want your user to have to enter in their Distinguished Name, locate the
user in your directory first who is attempting to authenticate, and then pass in
their Distinguished Name:</p>

<pre><code class="language-php">use LdapRecord\Container;
use LdapRecord\Models\ActiveDirectory\User;

$connection = Container::getConnection('default');

$user = User::findByOrFail('samaccountname', 'sbauman');

if ($connection-&gt;auth()-&gt;attempt($user-&gt;getDn(), 'SuperSecret')) {
    // Credentials are valid!
}
</code></pre>

<p>If you need to determine why the users authentication is failing (for example, if their password has expired),
you can retrieve the last message that was generated from your LDAP server. This message will usually
contain a code that you can use to determine the cause of failure:</p>

<pre><code class="language-php">if ($connection-&gt;auth()-&gt;attempt($user-&gt;getDn(), 'SuperSecret')) {
    // Credentials are valid!
} else {
    $message = $connection-&gt;getLdapConnection()-&gt;getDiagnosticMessage();

    if (strpos($message, '532') !== false) {
        return "Your password has expired.";
    }
}
</code></pre>

                <div class="mt-12 pt-8 pb-6 border-t-2 border-purple-200">
                        <div class="flex flex-col-reverse md:flex-row justify-between items-center">
    <div class="flex flex-col items-center md:items-start">
                    <span class="font-black text-gray-500 text-sm tracking-wider uppercase pb-1">← Previous Topic</span>
            <h4 class="font-bold underline m-0 text-blue-700">
                <a href="/docs/laravel/installation">Installation</a>
            </h4>
            </div>
    <div class="mb-8 md:mb-0 flex flex-col items-center md:items-end">
                    <span class="font-black text-gray-500 text-sm tracking-wider uppercase pb-1">Next Topic →</span>
            <h4 class="font-bold underline m-0 text-blue-700">
                <a href="/docs/laravel/auth/quickstart">Quickstart</a>
            </h4>
            </div>
</div>
                </div>

                <div class="mt-8 text-center hidden md:block">
                    <a class="font-black text-gray-500 text-sm tracking-wider uppercase" href="https://github.com/DirectoryTree/LdapRecord.com/blob/master/source//docs/laravel/usage.md" target="_blank">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="w-6 h-6 inline-block fill-current mr-1">
                            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path>
                        </svg>

                        Edit this Page
                    </a>
                </div>
            </div>
        </div>
    </section>
        </main>

        
        <script src="/assets/build/js/main.js?id=bcbc65921b92c4782f0d"></script>

        <script>
    const navMenu = {
        toggle() {
            const menu = document.getElementById('js-nav-menu');
            menu.classList.toggle('hidden');
            menu.classList.toggle('lg:block');
            document.getElementById('js-nav-menu-hide').classList.toggle('hidden');
            document.getElementById('js-nav-menu-show').classList.toggle('hidden');
        },
    }
</script>
            <script type="text/javascript">
            docsearch({
                apiKey: 'bc526397341486f980ca0b7ee7a0fa61',
                indexName: 'ldaprecord',
                inputSelector: '#docsearch-input',
                debug: false // Set debug to true if you want to inspect the dropdown
            });

            const searchInput = {
                toggle() {
                    const menu = document.getElementById('js-search-input');
                    menu.classList.toggle('hidden');
                    menu.classList.toggle('md:block');
                    document.getElementById('docsearch-input').focus();
                },
            }
        </script>
        </body>
</html>
